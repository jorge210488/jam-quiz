<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>üéÆ Live Quiz Test Client</title>
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <style>
      body {
        font-family: Arial;
        padding: 20px;
      }
      .log {
        background: #f0f0f0;
        padding: 10px;
        margin-top: 10px;
        white-space: pre-line;
      }
    </style>
  </head>
  <body>
    <h1>üéÆ Live Quiz Test Client</h1>

    <div>
      <label>Room ID:</label>
      <input type="text" id="roomId" value="room1" /><br />
      <label>Session ID:</label>
      <input type="text" id="sessionId" /><br />
      <label>User ID:</label>
      <input type="text" id="userId" /><br />
      <label>Duration per Question (sec):</label>
      <input type="number" id="durationPerQuestion" value="10" /><br /><br />

      <button onclick="joinRoom()">Join Room</button>
      <button onclick="startGame()">Start Game</button>
      <button onclick="sendAnswer()">Send Answer</button>
    </div>

    <h3>üìú Logs:</h3>
    <div class="log" id="logs"></div>

    <script>
      const socket = io("http://localhost:4000");
      let currentQuestionId = null;
      let lastPlayerScore = 0;

      function log(message) {
        const logs = document.getElementById("logs");
        logs.innerText += message + "\n";
      }

      socket.on("connect", () => {
        log(`‚úÖ Connected: ${socket.id}`);
      });

      socket.on("disconnect", () => {
        log(`üî¥ Disconnected`);
      });

      socket.on("userJoined", (user) => {
        log(`‚¨ÖÔ∏è userJoined ${user}`);
      });

      // Recibir nueva pregunta real
      socket.on("startQuestion", (data) => {
        currentQuestionId = data.questionId;

        log(`‚¨ÖÔ∏è startQuestion:
üÜî ID: ${data.questionId}
üß† Pregunta: ${data.questionText}
üìä Opciones:
${data.options.map((opt, i) => `   ${i + 1}. ${opt}`).join("\n")}
‚è∞ Finaliza en: ${data.endTime}`);
      });

      socket.on("questionTimeout", (data) => {
        log(`‚è∞ Tiempo terminado para pregunta: ${data.questionId}`);
      });

      socket.on("receiveAnswer", (data) => {
        lastPlayerScore = data.playerScore ?? 0;
        log(`‚¨ÖÔ∏è Respuesta recibida:
üôã Usuario: ${data.user}
‚úèÔ∏è Respuesta: ${data.answer}
‚úÖ ¬øCorrecta?: ${data.isCorrect ? "S√≠ üéØ" : "No ‚ùå"}
‚ö° PowerUp: ${data.powerUpUsed}
üèÜ Puntos ganados: ${data.pointsEarned}
üë• Puntos del equipo: ${data.teamScore ?? "N/A"}
üßç Puntaje TOTAL acumulado del jugador: ${data.playerScore ?? "N/A"}
`);
      });

      socket.on("gameFinished", (data) => {
        log(`üèÅ Fin del juego: ${data.message}
üëâ Puntaje final del jugador: ${lastPlayerScore}`);
      });

      function joinRoom() {
        const roomId = document.getElementById("roomId").value;
        const userId = document.getElementById("userId").value;

        socket.emit("joinRoom", { roomId, user: userId });
        log(`‚û°Ô∏è Emitido: joinRoom (room=${roomId}, user=${userId})`);
      }

      function startGame() {
        const roomId = document.getElementById("roomId").value;
        const sessionId = document.getElementById("sessionId").value;
        const durationPerQuestion = parseInt(
          document.getElementById("durationPerQuestion").value
        );

        socket.emit("startGame", { sessionId, roomId, durationPerQuestion });
        log(
          `‚û°Ô∏è Emitido: startGame (sessionId=${sessionId}, room=${roomId}, duraci√≥n=${durationPerQuestion}s)`
        );
      }

      function sendAnswer() {
        const roomId = document.getElementById("roomId").value;
        const sessionId = document.getElementById("sessionId").value;
        const userId = document.getElementById("userId").value;

        if (!currentQuestionId) {
          log("‚ùå No hay pregunta actual.");
          return;
        }

        const answer = prompt("Ingrese su respuesta:");
        const powerUpUsed = prompt(
          "¬øUs√≥ un power-up? (double_points, skip, none)",
          "none"
        );

        socket.emit("answer", {
          sessionId,
          roomId,
          user: userId,
          question: currentQuestionId,
          answer,
          timeTaken: Math.floor(Math.random() * 10) + 1,
          powerUpUsed,
        });

        log(
          `‚û°Ô∏è Emitido: answer (pregunta=${currentQuestionId}, respuesta=${answer}, powerUp=${powerUpUsed})`
        );
      }
    </script>
  </body>
</html>
